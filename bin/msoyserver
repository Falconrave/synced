#!/bin/sh
#
# $Id$
#
# Command line launcher for the Msoy development server

MSOY_HOME=`dirname $0`
MSOY_HOME=`cd $MSOY_HOME/.. ; pwd`

NODE="msoy1"
HOSTNAME=`hostname`

# Override settings with those from MSOY_HOME/dist/msoy-server.conf
if [ -f $MSOY_HOME/dist/msoy-server.conf ]; then
    . $MSOY_HOME/dist/msoy-server.conf
else
    echo "Can't load $MSOY_HOME/dist/msoy-server.conf; can't run server."
    exit 255
fi

JAVA_ARGS="-server -mx$SERVER_MEMORY \
           -Djava.awt.headless=true \
           -Dcom.samskivert.depot.cache_debug=false \
           -Djava.security.manager \
           -Djava.security.policy=$MSOY_HOME/dist/security.policy \
           -Dlog4j.configuration=log4j.properties \
           -Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger \
           -Dehcache.disk.store.dir=world"

# parse our arguments
while [ ! -z "$1" ]; do
    case "$1" in
        -*)
            JAVA_ARGS="$JAVA_ARGS $1"
            ;;

        *)
            NODE="$1"
            ;;
    esac
    shift
done

CLASS=com.threerings.msoy.server.MsoyServer
`dirname $0`/msoyjava msoy -ea -server -Dhostname=$HOSTNAME -Dnode=$NODE -Dis_node=true \
    $JAVA_ARGS $CLASS $*
