/* Facebook Connect helper crap (mostly because GWT + Facebook Connect == Fail). */
window.FB_WithInit = function(callback) {
  FB_RequireFeatures(["Api", "Connect"], function() {
    FB.init("@FB_API_KEY@", "/fbconnect.html");
  });
  window.FB_WithInit = FB.Bootstrap.ensureInit;
  FB_WithInit(function() {
    callback();
  });
};
window.FB_RequireSession = function() {
  FB_WithInit(function() {
    FB.Connect.requireSession(function() {
      FB_RequireSessionCallback(FB.Facebook.apiClient.get_session().uid);
      FB_RequireSessionCallback = null;
    });
  });
};
window.FB_PostStory = function(bundleId, data, targetIds, body) {
  FB_WithInit(function() {
    FB.Connect.showFeedDialog(bundleId, data, targetIds, body, FB.FeedStorySize.shortStory,
                              FB.RequireConnect.promptConnect, function () { /*noop*/ });
  });
};
window.FB_Logout = function() {
  FB_WithInit(function() {
    FB.Connect.logout(null);
  });
};
window.FB_ShowGameInvite = function(fbml, x, y, width, height) {
  /* TODO: why does FB_WithInit call my callback twice? Then I can remove this sentry. */
  window.FB_waitingForGameInvite = true
  FB_WithInit(function() {
    if (window.FB_waitingForGameInvite) {
      var dialog = new FB.UI.FBMLPopupDialog("Test", fbml);
      dialog.setContentWidth(width);
      dialog.setContentHeight(height);
      dialog.set_offset({x: x, y: y});
      dialog.show();
      window.FB_waitingForGameInvite = false;
    }
  });
};
